/****************************************************************************
 * Bitmovin Proprietary Software
 * Copyright (c) 2025, Bitmovin GmbH. All rights reserved.
 *
 * This software is proprietary and confidential to Bitmovin GmbH.
 * It may not be copied, modified, or distributed without explicit
 * written permission from Bitmovin GmbH.
 *
 * This software includes open-source components. See THIRD_PARTY_NOTICES
 * in the distribution for details.
 *
 * Bitmovin Player Version 8.235.0
 *
 ****************************************************************************/

(function() {
"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tizen=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player.tizen=t())}(self,(function(){return(self.webpackChunkbitmovin_player=self.webpackChunkbitmovin_player||[]).push([[405],{1124:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.getTvMseWrapperConstructor=function(){return void 0===r&&(r=f()),r};var r,o=n(3714),a=n(20213),s=n(70850),u=n(88052),c=n(24281),f=function(){return function(e){function t(t,n){var i=e.call(this,t)||this;return i.c7={},i.b7=n,i}return i(t,e),t.prototype.printDetailedBufferRange=function(e,t){var n;try{n=e.buffered}catch(e){return void this.logger.debug("".concat(t," buffer range: Error accessing buffered ranges"))}if(0!==n.length)for(var i=0;i<n.length;i++){var r=n.start(i),o=n.end(i);this.logger.debug("".concat(t," buffer range [").concat(i,"]: ").concat(this.b7.mapToExternalTime(r,!0)," - ").concat(this.b7.mapToExternalTime(o,!0)," (").concat(r," - ").concat(o,")"))}else this.logger.debug("".concat(t," buffer range: empty"))},t.prototype.getBufferStartTime=function(){var e=this,t=Object.keys(this.sourceBuffers).map((function(t){return 0===e.sourceBuffers[t].bufferedRanges.length?0:e.b7.mapToExternalTime(e.sourceBuffers[t].bufferedRanges[0].start)}));return Math.max.apply(null,t)},t.prototype.updateTimestampOffset=function(t,n){try{e.prototype.updateTimestampOffset.call(this,t,n)}catch(e){this.logger.error("Unable to update timestampOffset",e),e.code===DOMException.INVALID_STATE_ERR&&this.context.eventHandler.dispatchEvent(o.PlayerEvent.Warning,new a.PlayerWarning(a.WarningCode.PLAYBACK_WARNING,"Unable to update timestampOffset (Invalid State error)",e))}},t.prototype.d7=function(e,t){this.c7[e]||(this.c7[e]={currentOffset:this.sourceBuffers[e].buffer.timestampOffset,pendingOffset:t})},t.prototype.queueTimestampOffsetUpdate=function(t,n){var i=this;return this.d7(t,n),this.b7.getCorrectTimeStampOffset(t,n).then((function(e){return i.c7[t].pendingOffset=e})).then((function(){var n=i.c7[t].pendingOffset,r=i.c7[t].currentOffset;return s.Util.roundValue(r,6)===s.Util.roundValue(n,6)&&i.isMediaSourceOpen()?Promise.resolve():(i.logger.debug("Updating timestamp offset for ".concat(t," to ").concat(n," (uncorrected offset: ").concat(r,")")),i.c7[t].currentOffset=n,e.prototype.queueTimestampOffsetUpdate.call(i,t,n).finally((function(){var e,n,r=null===(n=null===(e=i.sourceBuffers[t])||void 0===e?void 0:e.buffer)||void 0===n?void 0:n.timestampOffset;i.c7[t].currentOffset=r})))}))},t.prototype.getBufferRangeStart=function(e,t){var n=this.b7.getEarliestExternalTimeBufferedRangeIndex(e);return e.start(n)},t.prototype.preBufferRemoval=function(e,t,n){this.logger.debug("removing buffer for ".concat(e," (from ").concat(this.b7.mapToExternalTime(t)," to ").concat(this.b7.mapToExternalTime(n),") (").concat(t," to ").concat(n,")"))},t.prototype.getRangePendingRemoval=function(e){return this.sourceBuffers.hasOwnProperty(e)&&this.b7.mapToExternalTimeRange(this.sourceBuffers[e].rangePendingRemoval)||void 0},t.prototype.addToBuffer=function(t){var n=this;return(0,c.rewriteUnsupportedBoxes)(t),this.e7(t).then((function(){return e.prototype.addToBuffer.call(n,t)}))},t.prototype.e7=function(e){var t=e.getMimeType(),n=-e.getPresentationTimeOffset();return e.isDirty()&&!e.isInit()?this.setTimestampOffset(t,n):Promise.resolve()},t}(u.ModuleManager.get(a.ModuleName.RendererMse).MSEWrapper)}},8301:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.findContinuousSegmentToMove=t.maybeSwitchOverASegmentToDiscontinuous=void 0;var i=n(44885);t.maybeSwitchOverASegmentToDiscontinuous=function(e){var n=(0,t.findContinuousSegmentToMove)(e);return n&&(e.continuousSegmentTimeInfoMap.deleteValue(n.mimeType,n),n.updateAsDiscontinuous(),(0,i.addSegmentTimeInfoToMap)(e.discontinuousSegmentTimeInfoMap,n.mimeType,n)),n},t.findContinuousSegmentToMove=function(e){var t=e.continuousSegmentTimeInfoMap.keys;if(2!==t.length)return null;if(t.every((function(t){return e.continuousSegmentTimeInfoMap.get(t).length>0})))return null;for(var n=0,i=t;n<i.length;n++){var r=i[n];if(e.discontinuousSegmentTimeInfoMap.has(r)&&!((e.discontinuousSegmentTimeInfoMap.get(r)||[]).length>0)){var o=e.continuousSegmentTimeInfoMap.get(r)||[];if(o.length)return o[0]}}return null}},21651:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentTimeInformationArrayMap=void 0;var r=function(e){function t(){return e.call(this,(function(e,t){return e.originalPlaybackTime-t.originalPlaybackTime}))||this}return i(t,e),t.prototype.find=function(e){if(e)return this.get(e.getMimeType()).find((function(t){return t.isSegmentMatching(e)}))},t}(n(61252).SortedArrayMap);t.SegmentTimeInformationArrayMap=r},24281:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.rewriteUnsupportedBoxes=function(e,t){void 0===t&&(t=o),t.forEach((function(t){var n,i=null===(n=e.getParsedData())||void 0===n?void 0:n.get(t);i&&(0,r.rewriteMp4BoxType)(i,"free")}))};var i=n(15487),r=n(2992),o=function(){var e=["skip"];return((0,i.isTizen2016)()||(0,i.isTizen2017)())&&e.push("moov.trak.edts"),e}()},26862:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_VALUE_32_BIT=t.TIZEN_2018_BUFFER_START_SAFETY_MARGIN=void 0,t.getTizenMSERendererConstructor=function(){if(null===l){var e=(0,d.getTvRendererConstructor)();l=function(e){function n(t){var n=e.call(this,t)||this;return n.ju=function(){var e,t,i;if("ended"===(null===(e=n.mse)||void 0===e?void 0:e.readyState))return null!==(t=n.getEndOfBufferTime())&&void 0!==t?t:-1;var r=n.context.sourceContext.sourceIdentifier,a=n.context.serviceManager.get(o.ServiceName.ManifestService,r),s=n.getDuration();if(null==a?void 0:a.isLive()){var u=Object.values(null!==(i=n.getRangesInSourceBuffers())&&void 0!==i?i:[]).find((function(e){return e.find((function(e){return e.end>s}))}));if(u)return u.reduce((function(e,t){return e.end<t.end?t:e})).end}return s},n.ku=function(){if(!n.iu&&!n.video.ended){var e=n.ju(),t=n.getCurrentTime();if(t&&e>0&&e-t<=1){var i=Math.max(e-t,0),r=(0,u.toMilliSeconds)(i)/n.video.playbackRate+(0,u.toMilliSeconds)(1);n.iu=setTimeout((function(){n.context.isDisposed||n.video.paused||(n.context.logger.debug("Firing fake ended event on Tizen"),n.video.eventHandler.triggerEvent(f.MediaElementEvent.ended)),n.iu=null}),r)}}},n.lu=function(){n.mu();var e=n.getDuration(),t=n.getCurrentTime();t&&e&&t>=e&&n.video.eventHandler.triggerEvent(f.MediaElementEvent.ended)},n.mu=function(){n.iu&&((0,c.clearTimeoutIfDefined)(n.iu),n.iu=null)},n.iu=null,n.video.addEventListener(f.MediaElementEvent.timeupdate,n.ku),n.video.addEventListener(f.MediaElementEvent.stalled,n.ku),n.video.addEventListener(f.MediaElementEvent.seeking,n.mu),n.video.addEventListener(f.MediaElementEvent.ended,n.mu),n.video.addEventListener(f.MediaElementEvent.pause,n.lu),n}return i(n,e),n.prototype.getMaxSafeBaseMediaDecodeTime=function(){return this.context.settings.TIZEN_MAX_SAFE_BMDT},n.prototype.getMaxSafePresentationTimeOffset=function(){return this.context.settings.TIZEN_MAX_SAFE_PTO},n.prototype.setDuration=function(e){this.mse&&(e=Math.floor(1e4*e)/1e4,isFinite(e)||(e=m),this.mse.setDuration(e))},n.prototype.getDuration=function(){var e,t,n,i,r,o=isNaN(null!==(t=null===(e=this.video)||void 0===e?void 0:e.duration)&&void 0!==t?t:NaN)?null!==(i=null===(n=this.mse)||void 0===n?void 0:n.getDuration())&&void 0!==i?i:0:null===(r=this.video)||void 0===r?void 0:r.duration;return o===m?1/0:null!=o?o:NaN},n.prototype.release=function(){return this.video.removeEventListener(f.MediaElementEvent.timeupdate,this.ku),this.video.removeEventListener(f.MediaElementEvent.stalled,this.ku),this.video.removeEventListener(f.MediaElementEvent.seeking,this.mu),this.video.removeEventListener(f.MediaElementEvent.ended,this.mu),this.video.removeEventListener(f.MediaElementEvent.pause,this.lu),e.prototype.release.call(this)},n.prototype.removeData=function(t,n,i){var r=this;return this.waitingForSeekedPromise&&this.logger.debug("Waiting for current seek operation to finish before clearing buffer data."),Promise.resolve(this.waitingForSeekedPromise).catch((function(e){r.logger.debug("The previous seek was rejected. Continuing with buffer removal.",e)})).then((function(){return e.prototype.removeData.call(r,t,n,i)}))},n.prototype.adjustTimeToNextCommonBufferStart=function(n){var i=e.prototype.adjustTimeToNextCommonBufferStart.call(this,n);return!isNaN(i)&&(0,s.isTizen2018)()&&this.video?function(e,t,n){var i=(0,r.getBufferedRanges)(e).find((function(e){return e.start<=t&&t<=e.end}));return i?Math.max(t,i.start+n):t}(this.video,i,t.TIZEN_2018_BUFFER_START_SAFETY_MARGIN):i},n.prototype.seekOnVideoElement=function(e){var t=this,n=-1,i=new Promise((function(i){var r=[f.MediaElementEvent.seeked,f.MediaElementEvent.playing,f.MediaElementEvent.canplay],o=function(){(0,c.clearTimeoutIfDefined)(n);var e=t.video.currentTime;i(t.getBaseMediaDecodeTimeHandler().then((function(t){return t.mapToExternalTime(e)}))),s()},s=function(){r.forEach((function(e){t.eventHandler.off(e,o)})),t.playerEventHandler.off(a.PlayerEvent.PeriodSwitched,o)};r.forEach((function(e){t.eventHandler.on(e,o)})),t.playerEventHandler.on(a.PlayerEvent.PeriodSwitched,o);try{t.video.currentTime=e}catch(e){throw s(),e}}));if((0,s.isTizen2017)()||(0,s.isTizen2018)()){var r=new Promise((function(i){n=window.setTimeout((function(){return i(t.getBaseMediaDecodeTimeHandler().then((function(t){return t.mapToExternalTime(e)})))}),p)}));this.waitingForSeekedPromise=Promise.race([r,i])}else this.waitingForSeekedPromise=i;return this.waitingForSeekedPromise},n.prototype.saveCurrentTime=function(){var e=this,t=Object.keys(this.segmentQueues).some((function(t){return e.getBufferedRanges(t).length>0}));this.setCurrentTimeContext?this.savedCurrentTime=this.setCurrentTimeContext.time:t&&(this.savedCurrentTime=this.getCurrentVideoTime())},n}(e)}return l};var r=n(4524),o=n(80813),a=n(3714),s=n(15487),u=n(89927),c=n(88844),f=n(19274),d=n(35501),l=null,m=Math.pow(2,32),p=1e3;t.TIZEN_2018_BUFFER_START_SAFETY_MARGIN=.02,t.MAX_VALUE_32_BIT=Math.pow(2,32)-1},28006:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.IncreasingTimeout=void 0;var i=n(88844),r=function(){function e(e,t,n){this.defaultInterval=e,this.maxInterval=t,this.intervalMultiplier=n,this.resetInterval()}return e.prototype.clearTimeout=function(){(0,i.clearTimeoutIfDefined)(this.YR)},e.prototype.setTimeout=function(e){this.clearTimeout(),this.YR=window.setTimeout((function(){return e()}),this.ZR)},e.prototype.resetInterval=function(){this.ZR=this.defaultInterval},e.prototype.increaseInterval=function(){this.ZR=Math.min(this.maxInterval,this.ZR*this.intervalMultiplier)},e}();t.IncreasingTimeout=r},35501:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.getTvRendererConstructor=function(){return void 0===o&&(o=m()),o};var o,a=n(4524),s=n(66790),u=n(34841),c=n(88052),f=n(62756),d=n(84276),l=n(1124),m=function(){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.postBufferRemoval=function(e,n,i){t.video&&(t.baseMediaDecodeTimeHandler.signalBufferRemoval(e,t.FS(e),t.video.currentTime),t.logger.debug("successfully removed buffer for ".concat(e," (from ").concat(t.baseMediaDecodeTimeHandler.mapToExternalTime(n)," to ").concat(t.baseMediaDecodeTimeHandler.mapToExternalTime(i),") (").concat(n," to ").concat(i,")")))},t}return i(t,e),t.prototype.init=function(t){this.baseMediaDecodeTimeHandler=new d.BaseMediaDecodeTimeHandler(this.context,this.ES.bind(this),this.getMaxSafeBaseMediaDecodeTime(),this.getMaxSafePresentationTimeOffset()),e.prototype.init.call(this,t),this.DS||(this.DS=new u.Deferred),this.DS.resolve(this.baseMediaDecodeTimeHandler)},t.prototype.getMaxSafeBaseMediaDecodeTime=function(){return 1/0},t.prototype.getMaxSafePresentationTimeOffset=function(){return 1/0},t.prototype.createMSEWrapper=function(){return new((0,l.getTvMseWrapperConstructor)())(this.context,this.baseMediaDecodeTimeHandler)},t.prototype.getCurrentVideoTime=function(){return this.baseMediaDecodeTimeHandler.mapToExternalTime(e.prototype.getCurrentVideoTime.call(this))},t.prototype.getRangesInSourceBuffers=function(){return this.baseMediaDecodeTimeHandler.mapToExternalTimeRangesMap(e.prototype.getRangesInSourceBuffers.call(this))},t.prototype.getBufferedRanges=function(t){return this.baseMediaDecodeTimeHandler.mapToExternalTimeRanges(e.prototype.getBufferedRanges.call(this,t))},t.prototype.getVideoElementBufferedRanges=function(){var t=e.prototype.getVideoElementBufferedRanges.call(this);return this.baseMediaDecodeTimeHandler.mapToExternalTimeRanges(t)},t.prototype.ES=function(e){var t,n,i=this;if(!this.mse)return Promise.reject();var r=null===(t=this.mse)||void 0===t?void 0:t.getBufferedRanges(e),o=null!==(n=null==r?void 0:r.slice(1))&&void 0!==n?n:[];return Promise.all(o.map((function(t){var n;return i.logger.debug("Clearing buffer on rollover for ".concat(e," from ").concat(t.start," to ").concat(t.end)),null===(n=i.mse)||void 0===n?void 0:n.removeFromBuffer(e,t.start-i.settings.GAP_TOLERANCE,t.end+i.settings.GAP_TOLERANCE,i.postBufferRemoval)}))).then((function(){}))},t.prototype.removeData=function(e,t,n){if(!this.mse)return Promise.reject();void 0===t&&void 0===n&&this.saveCurrentTime(),this.removeDataFromSegmentQueues(e,t,n);var i=void 0!==t?this.baseMediaDecodeTimeHandler.mapToInternalTime(t,!0,e):void 0,r=void 0!==n?this.baseMediaDecodeTimeHandler.mapToInternalTime(n,!0,e):void 0;return this.mse.removeFromBuffer(e,i,r,this.postBufferRemoval)},t.prototype.addSegmentFromQueueToMse=function(t){var n=this,i=this.getQueuedSegments((function(e){return!e.isInit()})),r=Object.keys(this.segmentQueues).every((function(e){var t=n.segmentQueues[e],i=n.mse&&n.mse.getBufferedRanges(e).length>0,r=Boolean(t.find((function(e){return!e.isInit()})));return i||r}));return r&&this.baseMediaDecodeTimeHandler.rewriteTimeStampsIfNecessary(i)?e.prototype.addSegmentFromQueueToMse.call(this,t):Promise.reject(s.SOURCE_BUFFER_APPEND_STATUS.SUSPENDED)},t.prototype.FS=function(e){var t,n;if(null===this.mse||!this.segmentQueues.hasOwnProperty(e))return[];var i=this.getQueuedSegments((function(e){return!e.isInit()})),o=this.baseMediaDecodeTimeHandler.getSegmentTimeRanges(i,e),s=null!==(n=null===(t=this.mse)||void 0===t?void 0:t.getBufferedRanges(e))&&void 0!==n?n:[];return a.BufferRangeHelper.mergeRanges(r(r([],o,!0),s,!0),this.settings.GAP_TOLERANCE)},t.prototype.adjustTimeToNextCommonBufferStart=function(t){var n=e.prototype.adjustTimeToNextCommonBufferStart.call(this,t);return isNaN(n)?NaN:Math.ceil(100*this.baseMediaDecodeTimeHandler.mapToInternalTime(n))/100},t.prototype.seekOnVideoElement=function(e){var t=this;return this.waitingForSeekedPromise=new Promise((function(n,i){if(t.video){t.video.currentTime=e;var r=t.video.currentTime;n(t.getBaseMediaDecodeTimeHandler().then((function(e){return e.mapToExternalTime(r)})))}else i("No video reference")})),this.waitingForSeekedPromise},t.prototype.getBaseMediaDecodeTimeHandler=function(){return this.DS.promise},t.prototype.getQueuedSegments=function(e){var t=this;return void 0===e&&(e=function(){return!0}),Object.keys(this.segmentQueues).flatMap((function(e){return t.segmentQueues[e]})).filter(e)},t.prototype.getEndOfBufferTime=function(){if(this.video&&this.video.buffered&&this.video.buffered.length>0&&this.baseMediaDecodeTimeHandler)return this.baseMediaDecodeTimeHandler.getEndOfBufferTime()},t.prototype.shutdown=function(t){var n=this;return e.prototype.shutdown.call(this,t).then((function(){n.GS()}))},t.prototype.GS=function(){this.DS=new u.Deferred,this.baseMediaDecodeTimeHandler.dispose()},t.prototype.release=function(){return this.GS(),e.prototype.release.call(this)},t}(c.ModuleManager.get(f.ModuleName.RendererMse).MSERenderer)}},44885:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.addSegmentTimeInfoToMap=void 0,t.ensureMimeTypeInMap=function(e,t){e.get(t)||e.addAll(t,[])},t.addSegmentTimeInfoToMap=function(e,t,n){(function(e,t,n){var i;return null===(i=e.get(t))||void 0===i?void 0:i.find((function(e){return e.segmentUrl===(null==n?void 0:n.segmentUrl)&&e.equals(n)}))})(e,t,n)||e.add(t,n)}},48558:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentTimeInformation=void 0,t.getSectionId=o;var i=n(4524),r=function(){function e(e,t){var n,i,r,a=this;this.equals=function(e){if(e){var t=a.mimeType===e.mimeType,n=a.duration===e.duration,i=a.originalBaseMediaDecodeTime===e.originalBaseMediaDecodeTime,r=a.discontinuityNr===e.discontinuityNr;return t&&n&&i&&r}return!1},this.segmentUrl=e.getUrl(),this.duration=e.getDuration(),this.mimeType=e.getMimeType(),this.timescale=null!==(n=e.getTimescale())&&void 0!==n?n:1,this.originalPlaybackTime=e.getPlaybackTime(),this.V8=null===(i=e.getSegmentInfo())||void 0===i?void 0:i.byteRange,this.originalBaseMediaDecodeTime=e.getBaseMediaDecodeTime(),this.originalPresentationTimeOffset=e.getPresentationTimeOffset()*this.timescale,this.isBaseMediaDecodeTimeLimitExceeded=this.originalBaseMediaDecodeTime+this.duration*this.timescale>t,this.periodId=e.getPeriodId(),this.discontinuityNr=null===(r=e.getSegmentInfo())||void 0===r?void 0:r.discontinuitySequenceNumber,this.U8=!1,this.sectionId=o(e),this.truncatedBaseMediaDecodeTime=1/0,this.truncatedPresentationTimeOffset=1/0,this.truncatedPlaybackTime=1/0}return Object.defineProperty(e.prototype,"isReferenceSegment",{get:function(){return this.U8},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackTime",{get:function(){return this.isBaseMediaDecodeTimeLimitExceeded&&this.truncatedPlaybackTime!==1/0?this.truncatedPlaybackTime:this.originalPlaybackTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseMediaDecodeTime",{get:function(){return this.isBaseMediaDecodeTimeLimitExceeded&&this.truncatedBaseMediaDecodeTime!==1/0?this.truncatedBaseMediaDecodeTime:this.originalBaseMediaDecodeTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"presentationTimeOffset",{get:function(){return this.isBaseMediaDecodeTimeLimitExceeded&&this.truncatedPresentationTimeOffset!==1/0?this.truncatedPresentationTimeOffset:this.originalPresentationTimeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRange",{get:function(){return{start:this.playbackTime,end:this.playbackTime+this.duration}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalPlaybackRange",{get:function(){return{start:this.originalPlaybackTime,end:this.originalPlaybackTime+this.duration}},enumerable:!1,configurable:!0}),e.prototype.getMatchingSegment=function(e){var t=this;return e.find((function(e){return t.isSegmentMatching(e)}))},e.prototype.isSegmentMatching=function(e){var t,n,i,r=e.getUrl()===this.segmentUrl,o=e.getPlaybackTime()===this.originalPlaybackTime,a=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.byteRange,s=(null==a?void 0:a.start)===(null===(n=this.V8)||void 0===n?void 0:n.start),u=(null==a?void 0:a.end)===(null===(i=this.V8)||void 0===i?void 0:i.end),c=s&&u,f=e.getMimeType()===this.mimeType;return r&&o&&c&&f},e.prototype.updateAsDiscontinuous=function(){this.isBaseMediaDecodeTimeLimitExceeded=!0},e.prototype.updateAsContinuous=function(e,t){this.truncatedBaseMediaDecodeTime=e,this.truncatedPresentationTimeOffset=t,this.truncatedPlaybackTime=(e-t)/this.timescale},e.prototype.markAsReferenceSegment=function(){this.U8=!0},e.prototype.isPlaybackRangeOverlapping=function(e){var t=this.playbackRange,n={buffered:e},r=i.BufferRangeHelper.isInBufferedRange(n,t.start),o=i.BufferRangeHelper.isInBufferedRange(n,t.end),a=i.BufferRangeHelper.getCommonBufferedRanges({buffered:e,inSegment:[t]}).length>0;return r||o||a},e}();function o(e){var t,n,i;return null!==(i=null===(n=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.discontinuitySequenceNumber)||void 0===n?void 0:n.toString())&&void 0!==i?i:e.getPeriodId()}t.SegmentTimeInformation=r},53188:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.createTizenDRMManager=function(e){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onInitDataAdded=function(n){e.prototype.addInitData.call(t,n)},t}return i(t,e),t.prototype.setConfig=function(t,n){var i=this;return e.prototype.setConfig.call(this,t,n).then((function(e){return null!==i.emeHandler&&s(i.emeHandler)&&i.emeHandler.addInitDataListener(i),e}))},t.prototype.fu=function(e){var t,n="";do{t=this.emeHandler.getIdentifierFromInitData(e.initDataStr)+n,n="-".concat(a.Util.generateUniqueId())}while(this.licenseStorage.getLicense(t,this.usedKeySystem.kind));return t},t.prototype.preprocessInitDataStr=function(e){if(e.initDataStr)return e.forceLicenseRequest?this.fu(e):this.emeHandler.getIdentifierFromInitData(e.initDataStr)},t.prototype.shutdown=function(){return null!==this.emeHandler&&s(this.emeHandler)&&this.emeHandler.removeInitDataListener(this),e.prototype.shutdown.call(this)},t}(r.ModuleManager.get(o.ModuleName.DRM).DRMManager))(e)};var r=n(88052),o=n(62756),a=n(70850),s=function(e){return"function"==typeof e.addInitDataListener&&"function"==typeof e.removeInitDataListener}},59235:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TizenModuleDefinition=void 0;var i=n(70962),r=n(15487),o=n(62756),a=n(53188),s=n(69411),u=n(26862),c=n(74682);t.TizenModuleDefinition={name:o.ModuleName.Tizen,module:function(){return{createTizenDRMManager:a.createTizenDRMManager,TizenVideoElementWrapper:c.TizenVideoElementWrapper,getTizenEMEHandlerConstructor:s.getTizenEMEHandlerConstructor,getTizenMSERendererConstructor:u.getTizenMSERendererConstructor}},dependencies:[o.ModuleName.RendererMse],hooks:{add:function(){var e;(0,r.isTizen2017)()&&(i.DefaultSettings.END_OF_BUFFER_TOLERANCE=.7),((0,r.isTizen2016)()||(0,r.isTizen2017)())&&(i.DefaultSettings.HLS_CLEAR_BUFFERS_ON_DISCONTINUITY_SWITCHES=!0),(null!==(e=(0,r.getTizenVersion)().major)&&void 0!==e?e:0)<r.TIZEN_2019_MAJOR_VERSION&&(i.DefaultSettings.TIZEN_MAX_SAFE_BMDT=4294967295,i.DefaultSettings.TIZEN_MAX_SAFE_PTO=4294967295)}}},t.default=t.TizenModuleDefinition},61252:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SortedArrayMap=void 0;var r=function(e){function t(t){var n=e.call(this)||this;return n.g8=t,n.h8=[],n}return i(t,e),t.prototype.getAllValues=function(){return this.h8},t.prototype.i8=function(e){return e?e.sort(this.g8):[]},t.prototype.set=function(t,n){var i=this.i8(n);return this.j8(t,i),e.prototype.set.call(this,t,i)},t.prototype.add=function(e,t){var n=t?[t]:[];return this.addAll(e,n),this},t.prototype.addAll=function(e,t){this.ensure(e),this.set(e,[].concat(t||[],this.get(e)))},t.prototype.delete=function(t){return this.k8(this.get(t)),e.prototype.delete.call(this,t)},t.prototype.deleteValue=function(t,n){return this.k8([n]),e.prototype.deleteValue.call(this,t,n)},t.prototype.clear=function(){this.h8=[],e.prototype.clear.call(this)},t.prototype.j8=function(e,t){void 0===t&&(t=[]);var n=this.get(e);this.k8(n),this.h8=this.i8(this.h8.concat(t))},t.prototype.k8=function(e){var t=this;void 0===e&&(e=[]),e.forEach((function(e){var n=t.h8.indexOf(e);n>-1&&t.h8.splice(n,1)}))},t}(n(19483).ArrayMap);t.SortedArrayMap=r},69411:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.getTizenEMEHandlerConstructor=function(){var e=a.ModuleManager.get(s.ModuleName.DRM);return null===u&&(u=function(e){function t(t){var n=e.call(this,t)||this;return n.hu=[],n.gu=new o.Deferred,n}return i(t,e),t.prototype.invokeEncryptedListener=function(t,n){var i=this;e.prototype.invokeEncryptedListener.call(this,t,n),n.forEach((function(e){return i.hu.forEach((function(n){n.onInitDataAdded(r(r({},e),{initData:t.buffer,forceLicenseRequest:!0}))}))})),this.gu.resolve()},t.prototype.addInitDataListener=function(e){this.hu.includes(e)||this.hu.push(e)},t.prototype.removeInitDataListener=function(e){var t=this.hu.findIndex((function(t){return t===e}));t>-1&&this.hu.splice(t,1)},t.prototype.requestLicense=function(t,n){var i=this;return this.gu.promise.then((function(){return e.prototype.requestLicense.call(i,t,n)}))},t}(e.WebKitPrefixedEMEHandler)),u};var o=n(34841),a=n(88052),s=n(62756),u=null},73849:function(e,t){function n(e){return Math.floor(e.originalBaseMediaDecodeTime-e.baseMediaDecodeTime)}function i(e){return Math.floor(e.originalPresentationTimeOffset-e.presentationTimeOffset)}function r(e,t,n){return e.find((function(e){var i=e.originalPlaybackRange.end;return t.originalPlaybackRange.start>=i-n&&t.originalPlaybackRange.start<=i+n}))}function o(e,t){return e.reduce((function(e,n){var i=n.originalPlaybackTime,r=e?e.originalPlaybackTime:-1/0;return i<t&&i>r?n:e}),void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.findOverflowDataForSegmentInMap=function(e,t,a,s){var u=1/0,c=1/0,f=r(t,e,a)||o(t,e.originalPlaybackTime),d=f?e.timescale/f.timescale:1;1!==d&&s.debug("Detected a timescale change: ".concat(null==f?void 0:f.timescale," -> ").concat(e.timescale));var l=f&&e.originalPresentationTimeOffset===f.originalPresentationTimeOffset*d;return l&&(u=e.originalBaseMediaDecodeTime-Math.round(n(f)*d),c=e.originalPresentationTimeOffset-Math.round(i(f)*d)),{baseMediaDecodeTime:u,presentationTimeOffset:c,foundMatchingPreviousSegment:Boolean(l)}},t.getBmdtOffset=n,t.getPtoOffset=i,t.shouldHandleOverflow=function(e,t){if(e.isBaseMediaDecodeTimeLimitExceeded)return!0;var n=o(t,e.originalPlaybackTime);return Boolean(null==n?void 0:n.isBaseMediaDecodeTimeLimitExceeded)},t.findPrecedingSegmentTimeInfo=r,t.getLargestPrecedingSegmentTimeInfo=o},74682:function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.TizenVideoElementWrapper=t.MaxSameCurrentTimeUpdate=void 0;var r=n(15487),o=n(19274),a=n(79186),s=n(28006);t.MaxSameCurrentTimeUpdate=10;var u=function(e){function n(t,n){var i=e.call(this,t,n)||this;i.su=function(){i.nu.clearTimeout()},i.tu=function(){i.element.seeking||i.pu===i.currentTime||i.nu.clearTimeout(),i.uu()};var o=(0,r.isTizen2018)()?2e4:8e3,a=(0,r.isTizen2018)()?1e4:1e3;return i.nu=new s.IncreasingTimeout(a,o,1.8),i.ou=0,i.pu=-1,i.qu(),i}return i(n,e),n.prototype.qu=function(){this.mediaElementEventHandler.addEventListener(o.MediaElementEvent.playing,this.su),this.mediaElementEventHandler.addEventListener(o.MediaElementEvent.timeupdate,this.tu)},n.prototype.ru=function(){this.mediaElementEventHandler&&(this.mediaElementEventHandler.removeEventListener(o.MediaElementEvent.playing,this.su),this.mediaElementEventHandler.removeEventListener(o.MediaElementEvent.timeupdate,this.tu))},n.prototype.uu=function(){this.element.seeking||(this.pu===this.element.currentTime?this.ou++:this.ou=0,this.ou===t.MaxSameCurrentTimeUpdate&&(this.context.logger.debug("[TizenVideoElementWrapper] Triggering proactive nudge due to same time reported ".concat(t.MaxSameCurrentTimeUpdate," times")),this.yu(this.pu),this.ou=0),this.pu=this.element.currentTime)},n.prototype.vu=function(e){var t=this;this.nu.setTimeout((function(){return t.xu(e)}))},n.prototype.wu=function(e,t){var n=function(e,t){var n=(e.end-t)/2,i=n+n*Math.random();return t+Math.min(.01+.1*Math.random(),i)}(e,t);this.context.logger.debug("[TizenVideoElementWrapper] Nudging video element (".concat(t," -> ").concat(n,")")),this.element.currentTime=n},n.prototype.xu=function(e){if(!this.element.seeking||this.element.playbackRate>1){var t=this.element.seeking?"playbackRate (".concat(this.element.playbackRate,") > 1, disabling currentTime safety checks"):"Video element is no longer seeking";return this.context.logger.debug("[TizenVideoElementWrapper] ".concat(t)),void this.nu.clearTimeout()}this.yu(e)},n.prototype.yu=function(e){var t=function(e,t){return function(e){var t=[];try{for(var n=0;n<e.buffered.length;n++)t.push({start:e.buffered.start(n),end:e.buffered.end(n)})}catch(e){}return t}(e).find((function(e){return e.start<=t&&e.end>=t}))}(this.element,e);return t?function(e){var t,n,i=null===(t=e.store)||void 0===t?void 0:t.getState(),r=null==i?void 0:i.drmLicenses,o=null!==(n=null==r?void 0:r.drmData)&&void 0!==n?n:{};return Object.keys(o).flatMap((function(e){return Object.keys(o[e]).map((function(t){return o[e][t]}))})).some((function(e){return e.wasRequested&&!e.hasLicense}))}(this.context)?(this.context.logger.debug("[TizenVideoElementWrapper] DRM license request is currently ongoing, waiting..."),this.nu.resetInterval(),void this.vu(e)):(this.wu(t,e),this.nu.increaseInterval(),void this.vu(e)):(this.context.logger.debug("[TizenVideoElementWrapper] No enclosing buffer range for the target time found, waiting..."),void this.vu(e))},Object.defineProperty(n.prototype,"currentTime",{get:function(){return this.element.currentTime},set:function(e){this.element.currentTime=e,this.nu.resetInterval(),this.ou=0,this.vu(e)},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this.nu.clearTimeout(),this.ru(),e.prototype.dispose.call(this)},n}(a.VideoElementWrapper);t.TizenVideoElementWrapper=u},84276:function(e,t,n){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMediaDecodeTimeHandler=t.PtoGapFillingMode=void 0;var r,o=n(4524),a=n(80813),s=n(87827),u=n(68925),c=n(47602),f=n(19483),d=n(34841),l=n(85434),m=n(15487),p=n(89927),g=n(19274),h=n(88052),v=n(62756),T=n(44885),y=n(73849),S=n(8301),M=n(48558),E=n(21651);!function(e){e.KeepGaps="keep-gaps",e.FillGaps="fill-gaps"}(r||(t.PtoGapFillingMode=r={}));var b=function(){function e(e,t,n,a){var s=this;this.maxSafeBaseMediaDecodeTime=n,this.maxSafePresentationTimeOffset=a,this.QS=function(){s.SS(s.HS.settings.END_OF_BUFFER_TOLERANCE)},this.RS=function(){s.SS(s.HS.settings.END_OF_BUFFER_RECOVERY_TOLERANCE)},this.XS=function(){if(s.HS.videoElement)try{var e=s.WS(),t=s.HS.videoElement.currentTime,n=s.TS(t).mapEach((function(e){return e.playbackRange})).mapAll((function(e){return o.BufferRangeHelper.mergeRanges(e,s.HS.settings.GAP_TOLERANCE)})).getObject(),r=o.BufferRangeHelper.getCommonBufferedRanges(i(i({},n),{bufferedRanges:e})).shift();if(void 0!==r){var a=r.getStart();s.HS.logger.debug("continuing playback at ".concat(a," (from ").concat(t,")")),s.HS.videoElement.currentTime=a,s.US(),s.HS.videoElement.eventHandler.removeEventListener(g.MediaElementEvent.currenttimenotadvancing,s.RS),s.OS().finally((function(){var e;return null===(e=s.PT())||void 0===e?void 0:e.dispatch((0,u.setTimestampRollingOver)(!1))})).then((function(){s.HS.logger.debug("successfully cleared previous buffers")})).catch((function(e){s.HS.logger.debug("could not clear previous buffers:",e)}))}else s.VS()}catch(e){s.HS.logger.debug("could not handle timestamp overflow:",e)}else s.HS.logger.debug("Could not handle timestamp overflow: Video Element is not defined")},this.HS=e,this.NS=r.KeepGaps,this.LS=t,this.IS=void 0,this.KS=new Map,this.JS=new E.SegmentTimeInformationArrayMap,this.HS.videoElement?(this.HS.videoElement.addEventListener(g.MediaElementEvent.waiting,this.RS),this.HS.videoElement.addEventListener(g.MediaElementEvent.stalled,this.RS),this.HS.videoElement.addEventListener(g.MediaElementEvent.timeupdate,this.QS),e.logger.debug("BaseMediaDecodeTime limit is set to ".concat(O(n)," bits")),e.logger.debug("PresentationTimeOffset limit is set to ".concat(O(a)," bits")),e.settings.FORCE_BASE_MEDIA_DECODE_TIME_REWRITE&&e.logger.debug("BaseMediaDecodeTime rewriting is forced!")):e.logger.debug("Could not set up BaseMediaDecodeTime rewriting: Video Element is not defined")}return e.prototype.OS=function(){var e=this,t=[];return this.PS().keys.forEach((function(n){t.push(e.LS(n))})),Promise.all(t).then((function(){}))},e.prototype.getEndOfBufferTime=function(){var e=o.BufferRangeHelper.getCommonBufferedRanges(this.PS(!0).getObject()).sort((function(e,t){return e.getStart()-t.getStart()}));return e.length>0?e[e.length-1].getEnd():0},e.prototype.setPtoGapFillingMode=function(e){this.NS=e},e.prototype.getEarliestExternalTimeBufferedRangeIndex=function(e){var t=0;try{for(var n=void 0,i=0;i<e.length;i++){var r=this.mapToExternalTime(e.start(i));(void 0===n||r<n)&&(n=r,t=i)}}catch(e){this.HS.logger.debug("Could not determine buffer region offset:",e)}return t},e.prototype.PS=function(e){var t=this;return void 0===e&&(e=!1),this.JS.mapEach((function(t){return e?t.originalPlaybackRange:t.playbackRange})).mapAll((function(e){return o.BufferRangeHelper.mergeRanges(e,t.HS.settings.GAP_TOLERANCE)}))},e.prototype.SS=function(e){var t,n,i=this.HS.videoElement;if(i){var r=i.currentTime;if(!(r>=i.duration&&i.duration>0)){var o=i.buffered;if(o.length<2)null===(t=this.PT())||void 0===t||t.dispatch((0,u.setTimestampRollingOver)(!1));else if(0!==this.getEarliestExternalTimeBufferedRangeIndex(o)){var a=o.end(o.length-1);r>=a-Math.max(this.HS.settings.MINIMAL_BACKWARD_BUFFER_CLEARING_INTERVAL,this.HS.settings.END_OF_BUFFER_TOLERANCE,this.HS.settings.END_OF_BUFFER_RECOVERY_TOLERANCE)&&(null===(n=this.PT())||void 0===n||n.dispatch((0,u.setTimestampRollingOver)(!0))),r>=a-e&&this.XS()}}}},e.prototype.TS=function(e){var t=this,n=this.HS.settings.GAP_TOLERANCE,i=new f.ArrayMap;return this.JS.keys.forEach((function(r){var o=!1,a=-1/0,s=t.JS.get(r),u=!1;s.sort((function(e,t){return e.originalPlaybackTime-t.originalPlaybackTime}));var c=s.filter((function(t){var i=t.playbackRange,r=i.start-n<=e&&i.end+n>=e;if(u=u||r,!isFinite(a)&&r)a=t.playbackTime;else if(isFinite(a))return o=o||t.playbackTime<a;return!1}));0!==c.length||u||(s.sort((function(e,t){return e.originalPlaybackTime-t.originalPlaybackTime})),c=s.filter((function(t){return t.playbackRange.end<e}))),i.addAll(r,c)})),i},e.prototype.US=function(){void 0!==this.IS&&(this.IS(),this.IS=void 0)},e.prototype.VS=function(){var e=this,t=this.PT();void 0!==t&&(this.US(),this.IS=(0,c.subscribeToRendererBufferChanges)(t,(function(){return e.RS()})))},e.prototype.WS=function(){var e,t=[],n=null===(e=this.HS.videoElement)||void 0===e?void 0:e.buffered;if(!function(e){return 0!==(null==e?void 0:e.length)}(n))return[];for(var i=0;i<n.length;i++)t.push({start:n.start(i),end:n.end(i)});return t},e.prototype.YS=function(e){var t,n=e.getMimeType(),i=e.getPlaybackTimeRange();if(void 0!==i){var r=(null!==(t=this.JS.get(n))&&void 0!==t?t:[]).filter((function(e){return e.originalPlaybackRange.end<i.end}));return r[r.length-1]}},e.prototype.ZS=function(e){var t=this,n=!1,i=!1,o=new E.SegmentTimeInformationArrayMap;return this.JS.keys.forEach((function(e){return(0,T.ensureMimeTypeInMap)(o,e)})),e.forEach((function(e){if(!e.isDirty()){var a=new M.SegmentTimeInformation(e,t.maxSafeBaseMediaDecodeTime),s=a.presentationTimeOffset/a.timescale,u=t.sS(s),c=t.tS(a);(n=n||u||c||t.HS.settings.FORCE_BASE_MEDIA_DECODE_TIME_REWRITE||t.oS(a)||t.pS(a,a.baseMediaDecodeTime,a.presentationTimeOffset))&&(a.isBaseMediaDecodeTimeLimitExceeded=!0);var f=t.YS(e),d=f?f.originalPresentationTimeOffset/f.timescale:s;d===s||t.NS!==r.FillGaps&&!(null==f?void 0:f.isBaseMediaDecodeTimeLimitExceeded)||(t.HS.logger.debug("Detected a presentation time offset change: ".concat(d," -> ").concat(s)),i=!0),(0,T.addSegmentTimeInfoToMap)(o,a.mimeType,a),a.isBaseMediaDecodeTimeLimitExceeded&&t.HS.logger.debug("BaseMediaDecodeTime (".concat(a.originalBaseMediaDecodeTime,") ")+"exceeding limit for ".concat(a.mimeType," segment"))}})),[n,i,o]},e.prototype.aS=function(e){return h.ModuleManager.has(v.ModuleName.ContainerMP4)?e.getTFDTBoxOffsets()||h.ModuleManager.get(v.ModuleName.ContainerMP4).parseTfdtBoxOffsets(e):(this.HS.logger.debug("Can't rewrite BMDT for TS segment as MP4 module is not available"),[])},e.prototype.bS=function(e,t){var n=this.aS(e);e.setTFDTBoxOffsets(n);var i=e.getBaseMediaDecodeTime()-t.truncatedBaseMediaDecodeTime;e.getTFDTBoxOffsets().forEach((function(t){var n=0,r=new DataView(e.getData(),t),o=r.getUint32(n);n+=4;var a=String.fromCharCode(r.getUint8(n++),r.getUint8(n++),r.getUint8(n++),r.getUint8(n++));if(n+=1===o?8:0,"tfdt"===a){var s=r.getUint8(n);n+=4,1===s?function(e,t,n){var i=e.getUint32(t),r=e.getUint32(t+4),o=i*Math.pow(2,32)+r-n;e.setUint32(t,Math.floor(o/Math.pow(2,32))),t+=4,e.setUint32(t,o)}(r,n,i):function(e,t,n){var i=e.getUint32(t)-n;e.setUint32(t,i)}(r,n,i)}})),e.setBaseMediaDecodeTime(t.truncatedBaseMediaDecodeTime),e.setDirty(!0)},e.prototype.cS=function(e,t){var n=this;t.forAll((function(t,i){(0,T.addSegmentTimeInfoToMap)(n.JS,t,i);var r=i.getMatchingSegment(e);r&&n.bS(r,i)}))},e.prototype.dS=function(e,t){return e.reduce((function(e,n){var i=t(n),r=Math.floor(i/n.timescale);return!isFinite(e)&&isFinite(r)||r<e?r:e}),-1/0)},e.prototype.eS=function(e,t){var n=this;return Math.min.apply(Math,e.transform((function(e){return n.dS(e,t)})))},e.prototype.fS=function(e){return this.eS(e,(function(e){return e.truncatedBaseMediaDecodeTime-e.truncatedPresentationTimeOffset}))},e.prototype.gS=function(e){return this.eS(e,(function(e){return e.originalPresentationTimeOffset}))},e.prototype.hS=function(e){var t={},n=this.gS(e);isFinite(n)?(e.forAll((function(e,i){var r=i.timescale,o=i.originalBaseMediaDecodeTime,a=i.originalPresentationTimeOffset,s=Math.floor(a-n*r),u=a-s,c=o-u,f=Math.floor(u/r);i.truncatedBaseMediaDecodeTime=c,i.truncatedPresentationTimeOffset=s,t.hasOwnProperty(e)||(t[e]=f)})),this.iS(t)):this.HS.logger.debug("Could not determine common PresentationTimeOffset divisor")},e.prototype.iS=function(e){var t=this;Object.keys(e).forEach((function(n){var i=t.KS.get(n);i&&i.resolve(e[n]);var r=new d.Deferred;t.KS.set(n,r),r.resolve(e[n])}))},e.prototype.jS=function(e,t){var n,i=this,r=this.fS(t);isFinite(r)?(t.forAll((function(t,n){var o=n.getMatchingSegment(e);o&&i.kS(o,n,r),(0,T.addSegmentTimeInfoToMap)(i.JS,t,n)})),null===(n=this.HS.videoElement)||void 0===n||n.addEventListener(g.MediaElementEvent.currenttimenotadvancing,this.RS)):this.HS.logger.debug("Could not determine common BaseMediaDecideTime divisor")},e.prototype.kS=function(e,t,n){t.truncatedBaseMediaDecodeTime=t.truncatedBaseMediaDecodeTime-t.timescale*n,t.truncatedPlaybackTime=(t.truncatedBaseMediaDecodeTime-t.truncatedPresentationTimeOffset)/t.timescale,this.bS(e,t)},e.prototype.lS=function(e){for(var t,n,i=e.keys,o=e.getAll(),a=[],s=1/0,u=0,c=i;u<c.length;u++){var f=c[u],d=(null!==(t=this.JS.get(f))&&void 0!==t?t:[]).filter((function(e){return!o.includes(e)&&!e.isReferenceSegment}));d.sort((function(e,t){return e.originalPlaybackTime-t.originalPlaybackTime}));var l=d.pop(),m=null!==(n=null==l?void 0:l.playbackRange.end)&&void 0!==n?n:1/0,p=e.get(f)||[];if(0===p.length)return 1/0;var g=Math.min.apply(Math,p.map((function(e){return e.playbackTime}))),h=g-m;s=Math.min(s,g),isFinite(h)&&a.push(h)}if(a.length!==i.length)return this.HS.logger.debug("No segments to align with end of buffer"),0;var v=s-this.HS.settings.GAP_TOLERANCE,T=this.NS===r.KeepGaps?Math.min.apply(Math,a):Math.max.apply(Math,a);return Math.min(T,v)},e.prototype.mS=function(e,t){var n=this,i=this.lS(t),r=!0;if(t.forAll((function(e,o){if(r){var a=o.timescale,s=i*a,u=o.truncatedPresentationTimeOffset+s,c=o.truncatedBaseMediaDecodeTime;n.qS(c,u,o,t)||(n.HS.logger.debug("Cannot shift segments to EOB: would exceed timestamp limits for ".concat(e)),r=!1)}})),r){this.HS.logger.debug("Aligning segments with EOB by shifting ".concat(i," seconds"));var o={};t.forAll((function(e,t){var n=t.timescale,r=i*n;t.updateAsContinuous(t.truncatedBaseMediaDecodeTime,t.truncatedPresentationTimeOffset+r);var a=t.originalPresentationTimeOffset-t.truncatedPresentationTimeOffset;o[e]=a/t.timescale})),this.iS(o),e.forEach((function(e){return e.setDirty(!0)}))}else this.HS.logger.debug("Cannot align segments with end of buffer: would exceed timestamp limits")},e.prototype.nS=function(e,t,n){return 0===t.length||(t.keys.every((function(e){return(t.get(e)||[]).length>0}))?(this.hS(t),this.jS(e,t),n&&this.mS(e,t),!0):(this.HS.logger.debug("Could not handle BaseMediaDecodeTime overflow: at least one buffer is empty"),!1))},e.prototype.oS=function(e){var t;return(0,y.shouldHandleOverflow)(e,null!==(t=this.JS.get(e.mimeType))&&void 0!==t?t:[])},e.prototype.pS=function(e,t,n){var i,r=e.duration,o=e.timescale,a=e.mimeType,s=this.JS.keys.find((function(e){return e!==a}));if(!s)return!1;var u=null===(i=this.JS.get(s))||void 0===i?void 0:i.slice(-1)[0];if(!u)return!1;var c=(t+n)/o,f={start:c,end:c+r},d=u.playbackTime+u.duration,l={start:d,end:d+u.duration},m=Math.max(f.start,l.start);return!(Math.min(f.end,l.end)-m<=r/2)&&l.end*u.timescale-u.presentationTimeOffset>this.maxSafeBaseMediaDecodeTime},e.prototype.qS=function(e,t,n,i){var r=this,o=n.duration,a=n.timescale;if(e+o*a>this.maxSafeBaseMediaDecodeTime)return this.HS.logger.debug("Detected BMDT overflow for ".concat(n.mimeType," segment")),!1;if(this.pS(n,e,t))return this.HS.logger.debug("Triggering early BMDT overflow for ".concat(n.mimeType," segment")),!1;var s=t/a,u=e/a+o,c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[];return e.forEach((function(e){e.forAll((function(e,t){n.includes(t.timescale)||n.push(t.timescale)}))})),n}(i,this.JS);return c.every((function(e){return r.rS(s,u,e)}))},e.prototype.rS=function(e,t,n){return t*n+e*n<=this.maxSafeBaseMediaDecodeTime},e.prototype.sS=function(e){return Math.abs(e)>this.maxSafePresentationTimeOffset},e.prototype.tS=function(e){if(!(0,m.isTizen2017)())return!1;var t=e.originalPlaybackTime,n=e.duration,i=e.mimeType,r=t+n>(0,p.toSeconds)(this.maxSafeBaseMediaDecodeTime);return l.MimeTypeHelper.isAudio(i)&&r},e.prototype.uS=function(e,t){if(this.HS.settings.FORCE_BASE_MEDIA_DECODE_TIME_REWRITE)return!0;var n=e/t.timescale;return!!this.sS(n)||this.tS(t)},e.prototype.vS=function(e,t,n){var i=e.baseMediaDecodeTime,r=e.presentationTimeOffset,o=e.foundMatchingPreviousSegment,a=!this.qS(i,r,t,n);return o?a:a||this.uS(r,t)},e.prototype.wS=function(e){var t=this,n=new f.ArrayMap,i=new f.ArrayMap;return e.keys.forEach((function(r){var o;(0,T.ensureMimeTypeInMap)(n,r),(0,T.ensureMimeTypeInMap)(i,r),(0,T.ensureMimeTypeInMap)(t.JS,r);var a=null!==(o=t.JS.get(r))&&void 0!==o?o:[],s=a.length?a:t.JS.getAllValues();(e.get(r)||[]).forEach((function(r){var o=(0,y.findOverflowDataForSegmentInMap)(r,s,t.HS.settings.GAP_TOLERANCE,t.HS.logger);if(t.vS(o,r,e))t.HS.logger.debug("Segment added to discontinuous time info map.",r.segmentUrl,r.mimeType),r.updateAsDiscontinuous(),(0,T.addSegmentTimeInfoToMap)(i,r.mimeType,r);else{var a=o.baseMediaDecodeTime,u=o.presentationTimeOffset;r.updateAsContinuous(a,u),(0,T.addSegmentTimeInfoToMap)(n,r.mimeType,r)}}))})),{discontinuousSegmentTimeInfoMap:i,continuousSegmentTimeInfoMap:n}},e.prototype.xS=function(e,t,n){var i,r=this.wS(t),o=r.discontinuousSegmentTimeInfoMap,a=r.continuousSegmentTimeInfoMap;if(this.cS(e,a),this.nS(e,o,n))return!0;var s=(0,S.maybeSwitchOverASegmentToDiscontinuous)({continuousSegmentTimeInfoMap:a,discontinuousSegmentTimeInfoMap:o});if(!s){var u=this.wS(this.JS);s=(0,S.maybeSwitchOverASegmentToDiscontinuous)({continuousSegmentTimeInfoMap:u.continuousSegmentTimeInfoMap,discontinuousSegmentTimeInfoMap:o}),this.HS.logger.debug("Did not find any matching segment time info in current map, retried with existing ones.",s)}return!!s&&(this.HS.logger.debug("Moved ".concat(s.mimeType," segment from continued to discontinued. Trying to process discontinued infos again."),{switchedSegmentUrl:s.segmentUrl,matchingSegmentUrl:null===(i=s.getMatchingSegment(e))||void 0===i?void 0:i.getUrl()}),this.nS(e,o,n))},e.prototype.IT=function(e){var t=this;e.forAll((function(e,n){var i;(null===(i=t.JS.get(e))||void 0===i?void 0:i.find(n.equals))||(0,T.addSegmentTimeInfoToMap)(t.JS,n.mimeType,n);var r=t.KS.get(n.mimeType);r&&r.resolve(0)}))},e.prototype.JT=function(e){return e.every((function(e){return l.MimeTypeHelper.isMP4(e.getMimeType())}))},e.prototype.KT=function(){this.maxSafeBaseMediaDecodeTime=1/0,this.maxSafePresentationTimeOffset=1/0},e.prototype.LT=function(){return this.maxSafeBaseMediaDecodeTime!==1/0||this.maxSafePresentationTimeOffset!==1/0},e.prototype.rewriteTimeStampsIfNecessary=function(e){var t;!this.JT(e)&&this.LT()&&(this.HS.logger.debug("Disabling BMDT rewriting due to unsupported container format"),this.KT());var n=this.MT(),i=e.map(M.getSectionId).reduce(D,[]).some((function(e){return!n.includes(e)})),r=function(e){return e.reduce((function(e,t){return e.includes(t.getMimeType())||e.push(t.getMimeType()),e}),[])}(e),o=this.JS.keys.every((function(e){return r.includes(e)}));if(i&&!o)return this.HS.logger.debug("Cannot check for rewriting necessity - not all buffers have data yet"),!1;var a=this.ZS(e),s=a[0],u=a[1],c=a[2];if(s)return this.xS(e,c,u);if(i&&u)return this.NT(e,c),!0;for(var f=0,d=c.getAllValues();f<d.length;f++){var l=d[f],m=l.mimeType,p=null!==(t=this.JS.get(m))&&void 0!==t?t:[],g=(0,y.findPrecedingSegmentTimeInfo)(p,l,this.HS.settings.GAP_TOLERANCE);(null==g?void 0:g.isBaseMediaDecodeTimeLimitExceeded)&&!l.isBaseMediaDecodeTimeLimitExceeded&&(l.updateAsDiscontinuous(),l.updateAsContinuous(l.originalBaseMediaDecodeTime,g.truncatedPresentationTimeOffset))}return this.IT(c),!0},e.prototype.MT=function(){return this.JS.transform((function(e){return e.map((function(e){return e.sectionId}))})).flatMap((function(e){return e})).reduce(D,[])},e.prototype.NT=function(e,t){this.HS.logger.debug("Detected a presentation time offset change, trying to handle it...");var n=this.lS(t),i={};t.forAll((function(e,t){var r=-n*t.timescale,o=r/t.timescale;t.isBaseMediaDecodeTimeLimitExceeded=!0,t.updateAsContinuous(t.originalBaseMediaDecodeTime,t.originalPresentationTimeOffset-r),i[t.mimeType]=o})),this.iS(i),this.IT(t),e.forEach((function(e){return e.setDirty(!0)}))},e.prototype.signalBufferRemoval=function(e,t,n){var i;if(this.JS.has(e)){var r=o.BufferRangeHelper.mergeRanges(t,this.HS.settings.GAP_TOLERANCE),a=this.JS.get(e)||[],s=a.filter((function(e){return e.isPlaybackRangeOverlapping(r)}));if(0===s.length&&this.iS(((i={})[e]=0,i)),this.OT(a,r,n)){var u=a[0];u.markAsReferenceSegment(),s.push(u)}this.JS.set(e,s)}},e.prototype.OT=function(e,t,n){if(!e.length||t.length)return!1;var i=this.HS.store.getState(),r=!!(null==i?void 0:i.player)&&(0,s.getIsSeekingOrTimeshifting)(i.player),o=this.HS.serviceManager.get(a.ServiceName.ManifestService,this.HS.sourceContext.sourceIdentifier),u=this.mapToExternalTime(n),c=null==o?void 0:o.getPeriodIdForTime(u);return!r&&e[0].periodId===c},e.prototype.mapToExternalTime=function(e,t){var n=this;void 0===t&&(t=!1);var i=this.JS.getAllValues(),r=i.find((function(t){var i=t.playbackRange.start-n.HS.settings.GAP_TOLERANCE,r=t.playbackRange.end+n.HS.settings.GAP_TOLERANCE;return!t.isReferenceSegment&&e>=i&&e<=r}))||(t?i[0]:void 0);return r&&(this.MS=r.originalPlaybackTime-r.playbackTime),this.mapToCachedExternalTime(e)},e.prototype.mapToCachedExternalTime=function(e){return void 0!==this.MS?Math.max(this.MS+e,0):(this.HS.logger.debug("Couldn't map internal time ".concat(e," to external time")),e)},e.prototype.mapToInternalTime=function(e,t,n){var i=this;void 0===t&&(t=!1);var r=this.JS.getAllValues().filter((function(e){return void 0===n||n===e.mimeType})),o=r.find((function(t){var n=t.originalPlaybackRange.start-i.HS.settings.GAP_TOLERANCE,r=t.originalPlaybackRange.end+i.HS.settings.GAP_TOLERANCE;return e>=n&&e<=r}))||(t?r[0]:void 0);return o?Math.max(o.playbackTime+(e-o.originalPlaybackTime),0):e},e.prototype.mapToExternalTimeRange=function(e){if(null!=e)return{start:this.mapToExternalTime(e.start),end:this.mapToExternalTime(e.end)}},e.prototype.mapToExternalTimeRanges=function(e){var t=this;return e.map((function(e){return t.mapToExternalTimeRange(e)})).filter((function(e){return void 0!==e}))},e.prototype.mapToExternalTimeRangesMap=function(e){var t=this;return null==e?null:Object.keys(e).reduce((function(n,i){return n[i]=t.mapToExternalTimeRanges(e[i]),n}),{})},e.prototype.getSegmentTimeRanges=function(e,t){var n=this,i=[];return e.forEach((function(e){var r=n.JS.get(t).find((function(t){return t.isSegmentMatching(e)}));r&&i.push(r.playbackRange)})),i},e.prototype.getCorrectTimeStampOffset=function(e,t){var n=this.KS.get(e);return n||(n=new d.Deferred,this.KS.set(e,n)),n.promise.then((function(e){return t+e}))},e.prototype.dispose=function(){var e,t,n,i;this.JS.clear(),this.US(),null===(e=this.HS.videoElement)||void 0===e||e.removeEventListener(g.MediaElementEvent.currenttimenotadvancing,this.RS),null===(t=this.HS.videoElement)||void 0===t||t.removeEventListener(g.MediaElementEvent.waiting,this.RS),null===(n=this.HS.videoElement)||void 0===n||n.removeEventListener(g.MediaElementEvent.stalled,this.RS),null===(i=this.HS.videoElement)||void 0===i||i.removeEventListener(g.MediaElementEvent.timeupdate,this.QS)},e.prototype.PT=function(){return this.HS.serviceManager.get(a.ServiceName.SourceStoreService,this.HS.sourceContext.sourceIdentifier)},e}();t.BaseMediaDecodeTimeHandler=b;var _=Math.log(2);function O(e){return Math.ceil(Math.log(e+1)/_)}function D(e,t){return e.includes(t)||e.push(t),e}}},function(e){return function(){return e(e.s=59235)}()}])}));
})();
